<!DOCTYPE html>
<html>
<head>
	<title>Audit Input</title>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet" type="text/css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script type="text/javascript" src="./JavaScript/Adapter.js"></script>
	<script type="text/javascript" src="./JavaScript/AUDIT.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
</head>
<body>
	<script type="text/javascript">
		function success(msg) { 
			//console.log(data1[0]);
          //var jsonString = data1[0];
          var jsonPretty = JSON.stringify(msg, null, 2);
          console.log(jsonPretty);

          $('#results').text(jsonPretty);
          console.log(msg);
      }
		function error(msg) { 
		  //alert(msg)
		  //var jsonString = data1[0];
          var jsonPretty = JSON.stringify(msg, null, 2);
          //console.log(jsonPretty)
          //document.body.innerHTML += JSON.stringify(xhr,null,10)
          //document.body.innerHTML = jsonPretty
          //console.log(xhr);
			console.log(msg); 
			$('#results').text(jsonPretty);
		}

		// READ ================================================================
		// ReadMany
		// Return: Array
		function readAudit(){
		audit.read({}, success, error)
		return false;
		}

		function displayAudits(){
		audit.read({}, function(audits){
				//console.log(data1[0]);
          //var jsonString = data1[0];
          var jsonPretty = JSON.stringify(audits, null, 2);
          console.log(jsonPretty)
          //document.body.innerHTML += JSON.stringify(xhr,null,10)
          //document.body.innerHTML = jsonPretty
          //console.log(xhr);


			var tableStr = "<table style=\"width:90%;\">";
			for(var i in audits){
				var audit = audits[i];
				tableStr += "<tr>";
				tableStr += "<td style=\"text-align:center;\">";
				tableStr += '<button onclick="displayUpdateAuditForm(\''+audits[i]._id+'\');">';
				tableStr += "Edit";
				tableStr += "</button>";
				tableStr += "</td>";
					tableStr += "<td style=\"text-align:center;\">";
				tableStr += audits[i].Description;
				tableStr += "</td>";
					tableStr += "<td style=\"text-align:center;\">";
					tableStr += '<button onclick="deleteAuditByID(\''+audits[i]._id+'\');">';
				tableStr += "Delete";
				tableStr += "</button>";
				tableStr += "</td>";
				tableStr += "</tr>";
			}
			tableStr += "</table>";
 		  
 		  $('#results').html(tableStr);	

		}, error)

		}

		//setup
		audit = AUDIT;
		displayAudits();

		// Read one via id
		// Return: Object
		// audit.get("5bb5e8b8467ec74b5ec111f7", success, error);

		// CREATE ==============================================================
		// Ceate one
		function createAudit(){

		var websheet_model_id = $('#auditForm input[name=websheet_model_id]').val();
		var Description = $('#auditForm input[name=Description]').val();
		var Notes = $('#auditForm input[name=Notes]').val();
		var LoanType = $('#auditForm input[name=LoanType]').val();
		var State = $('#auditForm input[name=State]').val();
		var Severity = $('#auditForm input[name=Severity]').val();
		var LoanStage = $('#auditForm input[name=LoanStage]').val();
		var RepeatOnField = $('#auditForm input[name=RepeatOnField]').val();
		var AuditLogic = $('#auditForm input[name=AuditLogic]').val();
		var AuditLogic = $('#auditForm input[name=AuditLogic]').val();
		var MessageCnd = $('#auditForm input[name=MessageCnd]').val();
		
		audit.create(
							{
							    "Description": Description,
						        "Notes": Notes,
						        "LoanType": LoanType,
						        "State": State,
						        "Severity": Severity,
						        "LoanStage": LoanStage,
						        "RepeatOnField": RepeatOnField,
						        "AuditLogic": AuditLogic,
						        "AuditLogic": AuditLogic,
						        "MessageCnd": MessageCnd
							}, 
							function (msg) { 
			//console.log(data1[0]);
          //var jsonString = data1[0];
          var jsonPretty = JSON.stringify(msg, null, 2);
          console.log(jsonPretty);
          //console.log(xhr);

          if(msg.result.ok){
          	alert("a audit is created")
          }
          else{
          	alert("error")
          }

          //$('#results').text(jsonPretty);
		displayAudits();

          console.log(msg);
      }, error); 

		return false;
		}

		// Delete by id
		function deleteAuditByID(_id){

		//var _id = $('#auditForm input[name=_id]').val();

		console.log(_id)

		if(!_id){
			alert("error")
			return;
		}

		audit.delete(	
						{ 
							"_id": _id

						}, 
							function(msg){
								console.log(msg)
								if(msg.result && msg.result.ok){
							displayAudits();
							alert("delete succeeded");
						}
						else{
							alert("delete failed");
						}
							}, error);
		return false;
		}

		// set =================================================================
		// Replace the a single document
		function replaceAudit(){
		var _id = $('#replaceAuditForm input[name=_id]').val();

		var websheet_model_id = $('#replaceAuditForm input[name=websheet_model_id]').val();
		var Description = $('#replaceAuditForm input[name=Description]').val();
		var Notes = $('#replaceAuditForm input[name=Notes]').val();
		var LoanType = $('#replaceAuditForm input[name=LoanType]').val();
		var State = $('#replaceAuditForm input[name=State]').val();
		var Severity = $('#replaceAuditForm input[name=Severity]').val();
		var LoanStage = $('#replaceAuditForm input[name=LoanStage]').val();
		var RepeatOnField = $('#replaceAuditForm input[name=RepeatOnField]').val();
		var AuditLogic = $('#replaceAuditForm input[name=AuditLogic]').val();
		var AuditLogic = $('#replaceAuditForm input[name=AuditLogic]').val();
		var MessageCnd = $('#replaceAuditForm input[name=MessageCnd]').val();

		audit.set(_id, 
					{
						"websheet_model_id": websheet_model_id,
						        "Description": Description,
						        "Notes": Notes,
						        "LoanType": LoanType,
						        "State": State,
						        "Severity": Severity,
						        "LoanStage": LoanStage,
						        "RepeatOnField": RepeatOnField,
						        "AuditLogic": AuditLogic,
						        "AuditLogic": AuditLogic,
						        "MessageCnd": MessageCnd
					}, 
					success, error);
		return false;
		}

		function displayUpdateAuditForm(_id){
		audit.read(
							{
								_id:_id,
							}, 
							loadUpdateAudit, error);
		}

		// update ==============================================================
		// modify the specific fileds
		function updateAudit(){


		var _id = $('#auditForm input[name=_id]').val();

		if(!_id){
			console.log("please create/select audit first!")
			alert("please select audit by clicking edit button for updating!")
			return;
		}

		console.log(_id)

		var websheet_model_id = $('#auditForm input[name=websheet_model_id]').val();
		var Description = $('#auditForm input[name=Description]').val();
		var Notes = $('#auditForm input[name=Notes]').val();
		var LoanType = $('#auditForm input[name=LoanType]').val();
		var State = $('#auditForm input[name=State]').val();
		var Severity = $('#auditForm input[name=Severity]').val();
		var LoanStage = $('#auditForm input[name=LoanStage]').val();
		var RepeatOnField = $('#auditForm input[name=RepeatOnField]').val();
		var AuditLogic = $('#auditForm input[name=AuditLogic]').val();
		var AuditLogic = $('#auditForm input[name=AuditLogic]').val();
		var MessageCnd = $('#auditForm input[name=MessageCnd]').val();

		audit.update(_id, 
					{
						"websheet_model_id": websheet_model_id,
						        "Description": Description,
						        "Notes": Notes,
						        "LoanType": LoanType,
						        "State": State,
						        "Severity": Severity,
						        "LoanStage": LoanStage,
						        "RepeatOnField": RepeatOnField,
						        "AuditLogic": AuditLogic,
						        "AuditLogic": AuditLogic,
						        "MessageCnd": MessageCnd
					}, 
					function (msg){
						if(msg.result && msg.result.ok){
							displayAudits();
							alert("update succeeded");
						}
						else{
							alert("update failed");
						}
					}, error);
		return false;
		}

		function loadUpdateAudit(msg){
	console.log(msg[0])
	var audit = msg[0];
	if(!audit){
		alert("error");
		return false;
	}
	var inputForm = '<form style="margin: auto; width: 80%; margin-top: 10px" id="auditForm" onSubmit="return false"><input type="hidden" name="_id"  placeholder="'+audit._id+'" value="'+audit._id+'">\
		<input type="hidden" name="websheet_model_id"  placeholder="'+audit.websheet_model_id+'" value="'+audit.websheet_model_id+'"><br> \
		Description:<br><input type="text" name="Description"  placeholder="'+audit.Description+'" value="'+audit.Description+'"><br> \
		Notes:<br><input type="text" name="Notes"  placeholder="'+audit.Notes+'" value="'+audit.Notes+'"><br> \
		Loan Type(s):<br><input type="text" name="LoanType"  placeholder="'+audit.LoanType+'" value="'+audit.LoanType+'"><br> \
		State:<br><input type="text" name="State"  placeholder="'+audit.State+'" value="'+audit.State+'"><br> \
		Severity:<br><input type="text" name="Severity"  placeholder="'+audit.Severity+'" value="'+audit.Severity+'"><br> \
		Loan Stage(s):<br><input type="text" name="LoanStage"  placeholder="'+audit.LoanStage+'" value="'+audit.LoanStage+'"><br> \
		Repeat on Field:<br><input type="text" name="RepeatOnField"  placeholder="'+audit.RepeatOnField+'" value="'+audit.RepeatOnField+'"><br> \
		Applicable Logic:<br><input type="text" name="AuditLogic"  placeholder="'+audit.AuditLogic+'" value="'+audit.AuditLogic+'"><br> \
		Audit Logic:<br><input type="text" name="AuditLogic"  placeholder="'+audit.AuditLogic+'" value="'+audit.AuditLogic+'"><br> \
		Message Cnd:<br><input type="text" name="MessageCnd"  placeholder="'+audit.MessageCnd+'" value="'+audit.MessageCnd+'"><br> \
		<br><br><button type="submit" onclick="javascript:createAudit()">Create</button> \
		<button type="submit" onclick="javascript:updateAudit()">Update</button> \
       </form>'
		;
		$('#container').html(inputForm);
        //console.log(msg);

		}


	</script>

  <div style="width:95%;float:left; border-style: solid; border-width: 1px; height: 600px; margin: 15px">
  
  <div style="width:25%;float:left; border-style: solid; border-width: 1px;height: 560px; margin: 15px; overflow:scroll;">
  	<!-- <div style="margin: 3px">Request:</div> -->
  	<div style="margin: 3px" id="container">
  		<form style="margin: auto; width: 80%; margin-top: 10px" id="auditForm" onSubmit="return false;"><input type="hidden" name="websheet_model_id"  placeholder="" value="5bb5c2d44fb2eb471851db57"><br>
		Description:<br><input type="text" name="Description"  placeholder="" value="""><br>
		Notes:<br><input type="text" name="Notes"  placeholder="" value="""><br>
		Loan Type(s):<br><input type="text" name="LoanType"  placeholder="" value="""><br>
		State:<br><input type="text" name="State"  placeholder="" value="""><br>
		Severity:<br><input type="text" name="Severity"  placeholder="" value="""><br>
		Loan Stage(s):<br><input type="text" name="LoanStage"  placeholder="" value="""><br>
		Repeat on Field:<br><input type="text" name="RepeatOnField"  placeholder="" value="""><br>
		Applicable Logic:<br><input type="text" name="AuditLogic"  placeholder="" value="""><br>
		Audit Logic:<br><input type="text" name="AuditLogic"  placeholder="" value="""><br>
		Message Cnd:<br><input type="text" name="MessageCnd"  placeholder="" value="""><br>
		<br><br><button type="submit" onclick="javascript:createAudit()">Create</button>
		<button type="submit" onclick="javascript:updateAudit()">Update</button> </form>
  	</div>
  </div>
  <div style="width:65%;float:left; border-style: solid; border-width: 1px;height: 560px; margin: 15px; overflow:scroll;">
<!--   	<div style="margin: 3px">Results:</div> -->
  	<div style="margin: auto; width: 95%; margin-top: 10px" id="results"></div>
  </div>
  
  </div>

</body>
</html>